<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÂºÄÂøÉÊ∂àÊ∂à‰πê - ÁªàÊûÅ‰øÆÂ§çÁâà</title>
    <style>
        /* ÂÜÖËÅîÊ†∑ÂºèÁ°Æ‰øù‰∏ç‰æùËµñÂ§ñÈÉ®CSSÊñá‰ª∂ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
            position: relative;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }

        .screen {
            position: relative;
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .screen.hidden {
            display: none;
        }

        .game-title {
            font-size: 3em;
            font-weight: bold;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 3s ease-in-out infinite;
            margin-bottom: 30px;
            text-align: center;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin: 10px;
            display: inline-block;
        }

        .btn-primary {
            background: linear-gradient(45deg, #ff6b6b, #ee5a6f);
            color: white;
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(255, 107, 107, 0.6);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
            box-shadow: 0 8px 20px rgba(78, 205, 196, 0.4);
        }

        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(78, 205, 196, 0.6);
        }

        .menu-buttons {
            display: flex;
            flex-direction: column;
            gap: 20px;
            max-width: 300px;
            margin: 0 auto;
            text-align: center;
        }

        .game-screen {
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }

        .game-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .game-canvas {
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            background: #fff;
            border: 3px solid #fff;
        }

        .game-info {
            min-width: 250px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .info-section {
            margin-bottom: 20px;
        }

        .info-section h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.3em;
            border-bottom: 2px solid #007bff;
            padding-bottom: 5px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 8px 12px;
            background: rgba(0, 123, 255, 0.1);
            border-radius: 8px;
        }

        .stat-value {
            font-weight: bold;
            color: #007bff;
            font-size: 1.1em;
        }

        .level-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 10px;
            max-height: 600px;
            overflow-y: auto;
            padding: 20px;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.5);
        }

        .level-btn {
            aspect-ratio: 1;
            border: none;
            border-radius: 15px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
            color: #495057;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .level-btn:hover {
            transform: scale(1.1);
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
        }

        .level-btn.completed {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.4);
        }

        .level-btn.completed:hover {
            background: linear-gradient(45deg, #1e7e34, #17a2b8);
            transform: scale(1.1);
        }

        .level-btn.completed::after {
            content: '‚úì';
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 0.8em;
            color: #fff;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 50%;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .error-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 0, 0, 0.9);
            color: white;
            padding: 20px;
            border-radius: 10px;
            z-index: 10000;
            text-align: center;
            font-size: 18px;
            max-width: 400px;
        }

        .loading {
            text-align: center;
            padding: 20px;
            font-size: 1.5em;
            color: #666;
        }

        .debug-info {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 9999;
            max-width: 300px;
        }

        /* ÊµÆÂä®ÊèêÁ§∫‰∏éÂ±Ç */
        .tip-layer{position:absolute;left:0;top:0;width:500px;height:500px;pointer-events:none;}
        .floating-tip{position:absolute;font-weight:bold;font-size:18px;color:#fff;text-shadow:0 0 6px #000;opacity:0;animation:tipFloat 1.2s ease-out forwards;}
        @keyframes tipFloat{0%{transform:translate(-50%,0) scale(0.9);opacity:0;}15%{opacity:1;}80%{opacity:1;}100%{transform:translate(-50%,-60px) scale(1.1);opacity:0;}}

        /* Èü≥È¢ëËß£ÈîÅÊåâÈíÆÂä®Áîª */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 5px #2196F3; }
            50% { box-shadow: 0 0 20px #2196F3, 0 0 30px #2196F3; }
        }

        .tool-bar{margin-top:10px;display:flex;flex-wrap:wrap;gap:6px;justify-content:center;}
        .tool-btn{padding:8px 14px;font-size:.9em;border-radius:25px;border:none;cursor:pointer;background:#444;color:#fff;transition:.25s;}
        .tool-btn.active{background:#ff9800;box-shadow:0 0 10px #ff9800aa;}
        .line-effect{position:absolute;left:0;top:0;pointer-events:none;}

        @media (max-width: 768px) {
            .game-screen {
                flex-direction: column;
            }
            .game-info {
                min-width: unset;
                width: 100%;
                order: -1;
            }
            .level-grid {
                grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div id="debugInfo" class="debug-info">Ê≠£Âú®Âä†ËΩΩÊ∏∏Êàè...</div>

    <div class="container">
        <!-- ‰∏ªËèúÂçïÁïåÈù¢ -->
        <div id="mainMenu" class="screen">
            <h1 class="game-title">üéÆ ÂºÄÂøÉÊ∂àÊ∂à‰πê</h1>
            <p style="text-align: center; font-size: 1.2em; color: #666; margin-bottom: 30px;">
                ÁªèÂÖ∏‰∏âÊ∂àÊ∏∏ÊàèÔºå100‰∏™ÂÖ≥Âç°Á≠â‰Ω†ÊåëÊàòÔºÅ
            </p>
            <div class="menu-buttons">
                <button id="startGameBtn" class="btn btn-primary">
                    üöÄ ÂºÄÂßãÊ∏∏Êàè
                </button>
                <button id="levelSelectBtn" class="btn btn-secondary">
                    üéØ ÈÄâÊã©ÂÖ≥Âç°
                </button>
                <button id="freePlayBtn" class="btn btn-secondary">
                    ‚ôæÔ∏è Ëá™Áî±Ê®°Âºè
                </button>
            </div>
        </div>

        <!-- ÂÖ≥Âç°ÈÄâÊã©ÁïåÈù¢ -->
        <div id="levelSelect" class="screen hidden">
            <h2 style="text-align: center; margin-bottom: 20px;">üéØ ÈÄâÊã©ÂÖ≥Âç°</h2>
            <div id="levelGrid" class="level-grid"></div>
            <div style="text-align: center; margin-top: 20px;">
                <button id="backToMenuBtn" class="btn btn-secondary">
                    üè† ËøîÂõû‰∏ªËèúÂçï
                </button>
            </div>
        </div>

        <!-- Ê∏∏ÊàèÁïåÈù¢ -->
        <div id="gameScreen" class="screen game-screen hidden">
            <!-- Ê∏∏Êàè‰ø°ÊÅØÈù¢Êùø -->
            <div class="game-info">
                <div class="info-section">
                    <h3>üìä Ê∏∏ÊàèÁä∂ÊÄÅ</h3>
                    <div class="stat-item">
                        <span>ÂÖ≥Âç°</span>
                        <span id="currentLevel" class="stat-value">1</span>
                    </div>
                    <div class="stat-item">
                        <span>ÂàÜÊï∞</span>
                        <span id="score" class="stat-value">0</span>
                    </div>
                    <div class="stat-item">
                        <span>Ââ©‰ΩôÊ≠•Êï∞</span>
                        <span id="moves" class="stat-value">30</span>
                    </div>
                    <div class="stat-item">
                        <span>ËøûÈîÅ</span>
                        <span id="chainInfo" class="stat-value">-</span>
                    </div>
                </div>

                <div class="info-section">
                    <h3>üéØ ÁõÆÊ†á</h3>
                    <div id="objective">ËææÂà∞ 2000 ÂàÜ</div>
                </div>

                <div class="info-section">
                    <h3>üéÆ ÊéßÂà∂</h3>
                    <div style="text-align: center;">
                        <button id="restartBtn" class="btn btn-primary">üîÑ ÈáçÂêØ</button>
                        <button id="muteBtn" class="btn btn-secondary">üîä ÈùôÈü≥</button>
                        <button id="loadAudioBtn" class="btn btn-secondary">üéµ Èü≥ÊïàÂåÖ</button>
                        <button id="backToLevelSelectBtn" class="btn btn-secondary">üìã ËøîÂõû</button>
                        <input id="audioFileInput" type="file" accept="audio/*" multiple style="display:none;" />
                        <div class="tool-bar">
                            <!-- ÁßªÈô§Èî§Â≠êÔºå‰ªÖ‰øùÁïôÊ¥óÁâå‰∏éÂΩ©Ëôπ‰∏ÄÊ¨°ÊÄßÈÅìÂÖ∑ -->
                            <button id="toolShuffle" class="tool-btn" title="Ê¥óÁâå: ÈáçÊñ∞Êâì‰π±Ê£ãÁõò">üîÅ Ê¥óÁâå</button>
                            <button id="toolColorBomb" class="tool-btn" title="‰∏ÄÊ¨°ÊÄßÔºöÂ∞ÜÁÇπÂáªÁöÑÂÆùÁü≥ÂèòÊàêÂΩ©Ëôπ">üåà ÂèòÂΩ©Ëôπ</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ê∏∏ÊàèÂå∫Âüü -->
            <div class="game-area">
                <canvas id="gameCanvas" class="game-canvas" width="500" height="500"></canvas>
                <div id="tipLayer" class="tip-layer"></div>
            </div>
        </div>
    </div>

    <!-- Èü≥È¢ëÂÖÉÁ¥†: Ê∑ªÂä†ÂÜÖÁΩÆbase64ÊàñÂç†‰ΩçÈü≥Ê∫ê -->
    <audio id="bgMusic" loop src="data:audio/mp3;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACcQCA//////////////////////////////////////////8AAAAALGFuYwAAAA8AAAACAAACcQCA//////////////////////////////////////////8AAAAA" preload="auto"></audio>
    <audio id="popSound" src="data:audio/mp3;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACcQCA//////////////////////////////////////////8AAAAALGFuYwAAAA8AAAACAAACcQCA//////////////////////////////////////////8AAAAA" preload="auto"></audio>
    <audio id="comboSound" src="data:audio/mp3;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACcQCA//////////////////////////////////////////8AAAAALGFuYwAAAA8AAAACAAACcQCA//////////////////////////////////////////8AAAAA" preload="auto"></audio>
    <audio id="winSound" src="data:audio/mp3;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACcQCA//////////////////////////////////////////8AAAAALGFuYwAAAA8AAAACAAACcQCA//////////////////////////////////////////8AAAAA" preload="auto"></audio>
    <audio id="loseSound" src="data:audio/mp3;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACcQCA//////////////////////////////////////////8AAAAALGFuYwAAAA8AAAACAAACcQCA//////////////////////////////////////////8AAAAA" preload="auto"></audio>

    <script>
        // ÂÖ®Â±ÄÊ∏∏ÊàèÂØπË±° - ÂÜÖÂµåÂÆûÁé∞Á°Æ‰øùÂèØÈù†ÊÄß
        let GameEngine = null;
        let isGameInitialized = false;
        
        // Ë∞ÉËØïÊó•ÂøóÂáΩÊï∞
        function debugLog(message, type = 'info') {
            const debugDiv = document.getElementById('debugInfo');
            if (debugDiv) {
                const timestamp = new Date().toLocaleTimeString();
                debugDiv.innerHTML = `[${timestamp}] ${message}`;
            }
            console.log(`[GAME] ${message}`);
        }

        // ÈîôËØØÂ§ÑÁêÜÂáΩÊï∞
        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-popup';
            errorDiv.innerHTML = `
                <h3>‚ö†Ô∏è ÈîôËØØ</h3>
                <p>${message}</p>
                <button onclick="location.reload()" class="btn btn-primary" style="margin-top: 10px;">
                    üîÑ Âà∑Êñ∞ÈáçËØï
                </button>
            `;
            document.body.appendChild(errorDiv);
            
            setTimeout(() => {
                if (errorDiv.parentNode) {
                    errorDiv.parentNode.removeChild(errorDiv);
                }
            }, 5000);
        }

        // ÁÆÄÂåñÁöÑUIÊéßÂà∂Âô®
        const SimpleUI = {
            currentScreen: 'mainMenu',
            
            showScreen(screenName) {
                debugLog(`ÂàáÊç¢Âà∞Â±èÂπï: ${screenName}`);
                
                const screens = ['mainMenu', 'levelSelect', 'gameScreen'];
                screens.forEach(screen => {
                    const element = document.getElementById(screen);
                    if (element) {
                        element.classList.add('hidden');
                    }
                });
                
                const targetScreen = document.getElementById(screenName);
                if (targetScreen) {
                    targetScreen.classList.remove('hidden');
                    this.currentScreen = screenName;
                    
                    if (screenName === 'levelSelect') {
                        this.createLevelGrid();
                    } else if (screenName === 'gameScreen') {
                        this.initGameScreen();
                    }
                }
            },
            
            createLevelGrid() {
                const grid = document.getElementById('levelGrid');
                if (!grid) return;
                
                grid.innerHTML = '';
                
                for (let i = 1; i <= 100; i++) {
                    const btn = document.createElement('button');
                    btn.className = 'level-btn';
                    btn.textContent = i.toString();
                    btn.onclick = () => this.startLevel(i);
                    
                    // Ê£ÄÊü•ÂÖ≥Âç°ÊòØÂê¶Â∑≤ÂÆåÊàê
                    if (GameEngine && GameEngine.unlockedLevels && GameEngine.unlockedLevels[i] && i > 1) {
                        // Â¶ÇÊûúÂÖ≥Âç°iÂ∑≤Ëß£ÈîÅÔºåËØ¥ÊòéÂÖ≥Âç°i-1Â∑≤ÂÆåÊàêÔºàÈô§‰∫ÜÁ¨¨‰∏ÄÂÖ≥Ôºâ
                        if (i === 2 || GameEngine.unlockedLevels[i-1]) {
                            // Ê£ÄÊü•ÊòØÂê¶ÊúâÂÆåÊàêËÆ∞ÂΩï
                            const completedLevels = GameEngine.getCompletedLevels();
                            if (completedLevels[i]) {
                                btn.classList.add('completed');
                            }
                        }
                    }
                    
                    // Á¨¨‰∏ÄÂÖ≥Â¶ÇÊûúÂ∑≤ÁªèËß£ÈîÅ‰∫ÜÁ¨¨‰∫åÂÖ≥ÔºåËØ¥ÊòéÂ∑≤ÂÆåÊàê
                    if (i === 1 && GameEngine && GameEngine.unlockedLevels && GameEngine.unlockedLevels[2]) {
                        const completedLevels = GameEngine.getCompletedLevels();
                        if (completedLevels[1]) {
                            btn.classList.add('completed');
                        }
                    }
                    
                    grid.appendChild(btn);
                }
            },
            
            startLevel(levelId) {
                debugLog(`ÂêØÂä®ÂÖ≥Âç° ${levelId}`);
                this.showScreen('gameScreen');
                
                if (GameEngine) {
                    GameEngine.startLevel(levelId);
                } else {
                    setTimeout(() => {
                        if (GameEngine) {
                            GameEngine.startLevel(levelId);
                        }
                    }, 500);
                }
            },
            
            initGameScreen() {
                const canvas = document.getElementById('gameCanvas');
                if (canvas && GameEngine) {
                    setTimeout(() => {
                        GameEngine.initCanvas();
                        GameEngine.render();
                    }, 100);
                }
            }
        };

        // ÂêàÂπ∂Âπ∂Â¢ûÂº∫Ê∏∏ÊàèÂºïÊìéÔºàÂä†ÂÖ•ÁâπÊÆäÂÆùÁü≥Ëß¶Âèë+È´òÁ∫ßËØÑÂàÜ+ÈùôÈü≥+‰∏ªÈ¢òÈ¢úËâ≤Ôºâ
        class SimpleGameEngine {
            constructor(){
                this.canvas=null; this.ctx=null; this.gridSize=8; this.tileSize=60; this.grid=[]; this.score=0; this.moves=0; this.baseMoves=20; this.levelId=1; this.targetScore=400; this.selectedGem=null; this.isPlaying=false; this.gemTypes=6;
                this.allColors=['#ff5722','#2196f3','#4caf50','#ffeb3b','#9c27b0','#ff9800','#00bcd4','#8bc34a','#e91e63'];
                this.gemColors=this.allColors.slice(0,this.gemTypes);
                this.animating=false; this.particles=[]; this.unlockedLevels=this.loadUnlocked(); this.audio=this.initAudio(); this.isMuted=false; this.comboChain=0; this.lastClearTime=0; this.accentColors=['#ff6b6b','#4ecdc4','#45b7d1','#96ceb4','#ffa94d','#9775fa','#74c0fc','#63e6be','#f06595'];
                this.currentChain=0; this.effects=[]; this.currentTool=null;
                this.images=[]; this.audioUnlocked=false; this.colorToolAvailable=true; // Êñ∞Â¢û
                this.imageWarned=false; // ÂõæÁâáÂä†ËΩΩÂ§±Ë¥•ÊèêÁ§∫Âè™ÊòæÁ§∫‰∏ÄÊ¨°
                this.preloadImages();
            }
            preloadImages(){
                console.log("=== ÂºÄÂßãÈ¢ÑÂä†ËΩΩÂÆùÁü≥ÂõæÁâá ===");
                this.imagesLoadedCount = 0;
                this.imagesFailedCount = 0;
                this.totalImages = this.allColors.length;
                
                for(let i=0;i<this.totalImages;i++){
                    const img=new Image();
                    // ÁßªÈô§crossOriginËÆæÁΩÆÔºåÂèØËÉΩÂØºËá¥Êú¨Âú∞Êñá‰ª∂Âä†ËΩΩÈóÆÈ¢ò
                    
                    img.onload=()=>{
                        console.log(`‚úì ÊàêÂäüÂä†ËΩΩÂÆùÁü≥ÂõæÁâá ${i}: images/gem${i}.png`);
                        img.loaded = true;
                        this.imagesLoadedCount++;
                        this.checkImageLoadComplete();
                    };
                    
                    img.onerror=(e)=>{ 
                        console.error(`‚úó Êó†Ê≥ïÂä†ËΩΩÂÆùÁü≥ÂõæÁâá ${i}: images/gem${i}.png`, e);
                        img.failed=true; 
                        this.imagesFailedCount++;
                        this.checkImageLoadComplete();
                    };
                    
                    // ÂÖàËÆæÁΩÆÂõæÁâáÂØπË±°ÔºåÂÜçËÆæÁΩÆsrcËß¶ÂèëÂä†ËΩΩ
                    this.images[i]=img;
                    // Ê∑ªÂä†Êó∂Èó¥Êà≥ÈÅøÂÖçÁºìÂ≠òÈóÆÈ¢ò
                    const timestamp = new Date().getTime();
                    img.src=`images/gem${i}.png?t=${timestamp}`;
                }
                debugLog(`Â∞ùËØïÂä†ËΩΩ ${this.totalImages} ‰∏™ÂÆùÁü≥ÂõæÁâá...`);
            }
            
            checkImageLoadComplete() {
                if(this.imagesLoadedCount + this.imagesFailedCount >= this.totalImages) {
                    const message = `ÂõæÁâáÂä†ËΩΩÂÆåÊàê: ÊàêÂäü ${this.imagesLoadedCount}/${this.totalImages}, Â§±Ë¥• ${this.imagesFailedCount}/${this.totalImages}`;
                    console.log("=== " + message + " ===");
                    debugLog(message);
                    
                    if(this.imagesLoadedCount === 0) {
                        debugLog("Ë≠¶Âëä: ÊâÄÊúâÂõæÁâáÂä†ËΩΩÂ§±Ë¥•ÔºåÂ∞Ü‰ΩøÁî®ÂΩ©Ëâ≤ÂúÜÂΩ¢Êõø‰ª£");
                    }
                }
            }
            // Èü≥È¢ë
            initAudio(){
                console.log("=== ÂàùÂßãÂåñÈü≥È¢ëÁ≥ªÁªü ===");
                const audioElements = {
                    bg:document.getElementById('bgMusic'),
                    pop:document.getElementById('popSound'),
                    combo:document.getElementById('comboSound'),
                    win:document.getElementById('winSound'),
                    lose:document.getElementById('loseSound')
                };
                
                // Ê£ÄÊü•Èü≥È¢ëÂÖÉÁ¥†ÊòØÂê¶Â≠òÂú®
                Object.keys(audioElements).forEach(key => {
                    if(!audioElements[key]) {
                        console.error(`Èü≥È¢ëÂÖÉÁ¥†‰∏çÂ≠òÂú®: ${key}`);
                    } else {
                        console.log(`‚úì Èü≥È¢ëÂÖÉÁ¥†Â∑≤ÊâæÂà∞: ${key}`);
                        // ËÆæÁΩÆÈü≥È¢ëÂ±ûÊÄß
                        audioElements[key].preload = 'auto';
                        audioElements[key].volume = 0.6;
                    }
                });
                
                return audioElements;
            }
            ensureAudioUnlock(){
                if(this.audioUnlocked) return;
                
                console.log("=== ËÆæÁΩÆÈü≥È¢ëËß£ÈîÅÊú∫Âà∂ ===");
                
                const unlock=()=>{
                    debugLog("Áî®Êà∑‰∫§‰∫íËß¶ÂèëÔºåÂ∞ùËØïËß£ÈîÅÈü≥È¢ë...");
                    let unlockedCount = 0;
                    const audioElements = ['bg','pop','combo','win','lose'];
                    let totalElements = audioElements.length;
                    
                    audioElements.forEach(k => { 
                        const a=this.audio[k]; 
                        if(a){ 
                            try{
                                // ‰ΩøÁî®ÈùôÈü≥ÊñπÂºèËß¶Âèë‰ª•ÈÅøÂÖçÊÑèÂ§ñÁöÑÂ£∞Èü≥
                                const originalVolume = a.volume;
                                a.volume = 0.001;
                                
                                // ÈáçÁΩÆÊí≠Êîæ‰ΩçÁΩÆ
                                a.currentTime = 0;
                                
                                const playPromise = a.play();
                                
                                if(playPromise !== undefined) {
                                    playPromise
                                        .then(() => {
                                            a.pause(); 
                                            a.currentTime=0;
                                            a.volume = originalVolume;
                                            unlockedCount++;
                                            console.log(`‚úì Èü≥È¢ë ${k} Ëß£ÈîÅÊàêÂäü`);
                                            
                                            // ÂΩìÊâÄÊúâÈü≥È¢ëÈÉΩËß£ÈîÅÂêéÊòæÁ§∫ÊèêÁ§∫
                                            if(unlockedCount === totalElements) {
                                                this.audioUnlocked = true;
                                                this.showTip('üéµ Èü≥È¢ëÁ≥ªÁªüÂ∑≤Ëß£ÈîÅ', 250, 220);
                                                debugLog("Èü≥È¢ëÁ≥ªÁªüÂÆåÂÖ®Ëß£ÈîÅ");
                                                this.removeAudioUnlockButton();
                                            }
                                        })
                                        .catch(e => {
                                            console.error(`‚úó Èü≥È¢ë ${k} Ëß£ÈîÅÂ§±Ë¥•:`, e);
                                            unlockedCount++;
                                            if(unlockedCount === totalElements) {
                                                this.audioUnlocked = true; // Âç≥‰ΩøÈÉ®ÂàÜÂ§±Ë¥•‰πüÊ†áËÆ∞‰∏∫Â∑≤Â∞ùËØï
                                                this.showTip('üéµ Èü≥È¢ëÈÉ®ÂàÜËß£ÈîÅ', 250, 220);
                                                this.removeAudioUnlockButton();
                                            }
                                        });
                                } else {
                                    // ÊóßÁâàÊµèËßàÂô®‰∏çËøîÂõûPromise
                                    setTimeout(() => {
                                        a.pause(); 
                                        a.currentTime=0;
                                        a.volume = originalVolume;
                                    }, 100);
                                    unlockedCount++;
                                    if(unlockedCount === totalElements) {
                                        this.audioUnlocked = true;
                                        this.removeAudioUnlockButton();
                                    }
                                }
                            } catch(e) {
                                console.error(`Â∞ùËØïËß£ÈîÅÈü≥È¢ë ${k} Âá∫Èîô:`, e);
                                unlockedCount++;
                                if(unlockedCount === totalElements) {
                                    this.audioUnlocked = true;
                                    this.removeAudioUnlockButton();
                                }
                            } 
                        } else {
                            console.warn(`Èü≥È¢ëÂÖÉÁ¥† ${k} ‰∏çÂ≠òÂú®`);
                            unlockedCount++;
                            if(unlockedCount === totalElements) {
                                this.audioUnlocked = true;
                                this.removeAudioUnlockButton();
                            }
                        }
                    });
                };
                
                // ÁªëÂÆöÂ§öÁßç‰∫ã‰ª∂Á°Æ‰øùÂÖºÂÆπÊÄß
                document.addEventListener('click', unlock, {once:true});
                document.addEventListener('touchstart', unlock, {once:true});
                document.addEventListener('keydown', unlock, {once:true});
                
                // ÂàõÂª∫ÊòéÊòæÁöÑÈü≥È¢ëËß£ÈîÅÊåâÈíÆ
                this.createAudioUnlockButton(unlock);
            }
            
            createAudioUnlockButton(unlockFunction) {
                // ÁßªÈô§Â∑≤Â≠òÂú®ÁöÑÊåâÈíÆ
                this.removeAudioUnlockButton();
                
                const unlockBtn = document.createElement('button');
                unlockBtn.id = 'audioUnlockButton';
                unlockBtn.textContent = 'üéµ ÁÇπÂáªËß£ÈîÅÈü≥È¢ë';
                unlockBtn.className = 'btn btn-primary';
                unlockBtn.style.cssText = `
                    position: fixed;
                    top: 10px;
                    left: 10px;
                    z-index: 10000;
                    animation: pulse 2s infinite, glow 3s infinite;
                    font-weight: bold;
                    border: 2px solid #fff;
                `;
                
                unlockBtn.onclick = () => {
                    unlockFunction();
                };
                
                document.body.appendChild(unlockBtn);
                
                // 10ÁßíÂêéËá™Âä®ÈöêËóèÊåâÈíÆ
                setTimeout(() => {
                    this.removeAudioUnlockButton();
                }, 10000);
            }
            
            removeAudioUnlockButton() {
                const existingBtn = document.getElementById('audioUnlockButton');
                if(existingBtn && existingBtn.parentNode) {
                    existingBtn.parentNode.removeChild(existingBtn);
                }
            }
            loadAudioPack(name){ 
                console.log(`=== Â∞ùËØïÂä†ËΩΩÈü≥È¢ëÂåÖ: ${name} ===`);
                debugLog(`ÂºÄÂßãÂä†ËΩΩÈü≥È¢ëÂåÖ: ${name}`);
                
                if(name==='9439'){ 
                    const map={bg:'bg',pop:'pop',combo:'combo',win:'win',lose:'lose'}; 
                    let loadedCount = 0;
                    let errorCount = 0;
                    let totalCount = Object.keys(map).length;
                    
                    const checkComplete = () => {
                        if(loadedCount + errorCount >= totalCount) {
                            const message = `Èü≥È¢ëÂåÖÂä†ËΩΩÂÆåÊàê: ÊàêÂäü ${loadedCount}/${totalCount}, Â§±Ë¥• ${errorCount}/${totalCount}`;
                            console.log("=== " + message + " ===");
                            debugLog(message);
                            
                            if(loadedCount > 0) {
                                this.showTip('üéµ 9439Èü≥ÊïàÂåÖÂä†ËΩΩÂÆåÊàê',250,220);
                            } else {
                                this.showTip('‚ö†Ô∏è Èü≥ÊïàÂåÖÂä†ËΩΩÂ§±Ë¥•',250,220);
                            }
                        }
                    };
                    
                    for(const k in map){ 
                        const el=this.audio[k]; 
                        if(el){ 
                            const url = `audio/9439/${map[k]}.mp3`;
                            console.log(`ÂºÄÂßãÂä†ËΩΩÈü≥È¢ë: ${url}`);
                            
                            // Ê∑ªÂä†Êó∂Èó¥Êà≥ÈÅøÂÖçÁºìÂ≠òÈóÆÈ¢ò
                            const timestamp = new Date().getTime();
                            const urlWithTimestamp = `${url}?t=${timestamp}`;
                            
                            el.oncanplaythrough = () => {
                                console.log(`‚úì Èü≥È¢ëÂä†ËΩΩÊàêÂäü: ${url}`);
                                loadedCount++;
                                checkComplete();
                            };
                            
                            el.onloadeddata = () => {
                                console.log(`‚úì Èü≥È¢ëÊï∞ÊçÆÂä†ËΩΩ: ${url}`);
                            };
                            
                            el.onerror = (e) => {
                                console.error(`‚úó Âä†ËΩΩÈü≥È¢ëÂ§±Ë¥•: ${url}`, e);
                                errorCount++;
                                checkComplete();
                            };
                            
                            // ËÆæÁΩÆÊ∫êÂπ∂ÂºÄÂßãÂä†ËΩΩ
                            try {
                                el.src = urlWithTimestamp; 
                                el.load();
                            } catch(e) {
                                console.error(`ËÆæÁΩÆÈü≥È¢ëÊ∫êÂ§±Ë¥•: ${url}`, e);
                                errorCount++;
                                checkComplete();
                            }
                        } else {
                            console.error(`Èü≥È¢ëÂÖÉÁ¥†‰∏çÂ≠òÂú®: ${k}`);
                            errorCount++;
                            checkComplete();
                        }
                    }
                    
                    // Á°Æ‰øùÈü≥È¢ëËß£ÈîÅ
                    this.ensureAudioUnlock(); 
                } else {
                    console.warn(`Êú™Áü•ÁöÑÈü≥È¢ëÂåÖ: ${name}`);
                    debugLog(`Êú™Áü•ÁöÑÈü≥È¢ëÂåÖ: ${name}`);
                }
            }
            play(name,vol=0.6){ 
                if(this.isMuted) {
                    //console.log(`Èü≥È¢ëÂ∑≤ÈùôÈü≥ÔºåË∑≥ËøáÊí≠Êîæ: ${name}`);
                    return;
                } 
                
                const a=this.audio[name]; 
                if(!a) {
                    console.warn(`Èü≥È¢ëÂÖÉÁ¥†‰∏çÂ≠òÂú®: ${name}`);
                    return;
                } 
                
                try{ 
                    // Ê£ÄÊü•Èü≥È¢ëÊòØÂê¶ÂèØ‰ª•Êí≠Êîæ
                    if(a.readyState >= 2) { // HAVE_CURRENT_DATA ÊàñÊõ¥È´ò
                        a.currentTime=0; 
                        a.volume=vol; 
                        
                        const playPromise = a.play();
                        if(playPromise !== undefined) {
                            playPromise
                                .then(() => {
                                    //console.log(`Èü≥È¢ëÊí≠ÊîæÊàêÂäü: ${name}`);
                                })
                                .catch(error => {
                                    console.error(`Êí≠Êîæ${name}Â§±Ë¥•:`, error);
                                    // Â¶ÇÊûúÊòØËá™Âä®Êí≠ÊîæÈôêÂà∂ÂØºËá¥ÁöÑÈîôËØØÔºåÂ∞ùËØïËß£ÈîÅÈü≥È¢ë
                                    if(error.name === "NotAllowedError") {
                                        console.log("Ê£ÄÊµãÂà∞Ëá™Âä®Êí≠ÊîæÈôêÂà∂ÔºåÂ∞ùËØïËß£ÈîÅÈü≥È¢ë");
                                        this.ensureAudioUnlock();
                                    }
                                });
                        }
                    } else {
                        console.warn(`Èü≥È¢ë ${name} Â∞öÊú™ÂáÜÂ§áÂ•ΩÊí≠Êîæ (readyState: ${a.readyState})`);
                    }
                }catch(e){
                    console.error(`Êí≠Êîæ${name}ÂºÇÂ∏∏:`, e);
                } 
            }
            toggleMute(){ this.isMuted=!this.isMuted; const btn=document.getElementById('muteBtn'); if(btn) btn.textContent=this.isMuted?'üîá Ëß£Èô§ÈùôÈü≥':'üîä ÈùôÈü≥'; if(!this.isMuted){ this.play('bg',0.4);} else { Object.values(this.audio).forEach(a=>{try{a.pause();}catch(e){}});} }
            // Â≠òÊ°£
            loadUnlocked(){ try{ const d=localStorage.getItem('match3_unlocked'); if(d) return JSON.parse(d);}catch(e){} return {1:true}; }
            saveUnlocked(){ try{ localStorage.setItem('match3_unlocked',JSON.stringify(this.unlockedLevels)); }catch(e){} }
            
            // ÂÆåÊàêÂÖ≥Âç°ËÆ∞ÂΩï
            getCompletedLevels(){ try{ const d=localStorage.getItem('match3_completed'); if(d) return JSON.parse(d);}catch(e){} return {}; }
            saveCompletedLevel(levelId){ try{ const completed=this.getCompletedLevels(); completed[levelId]=true; localStorage.setItem('match3_completed',JSON.stringify(completed)); }catch(e){} }
            // ÁîªÂ∏É
            initCanvas(){ if(this.canvas) return true; this.canvas=document.getElementById('gameCanvas'); if(!this.canvas) return false; this.ctx=this.canvas.getContext('2d'); if(!this.ctx) return false; const size=Math.min(this.canvas.width,this.canvas.height); this.tileSize=size/this.gridSize; this.canvas.onclick=e=>this.handleClick(e); requestAnimationFrame(()=>this.render()); return true; }
            // ÂÖ≥Âç°ÈÖçÁΩÆ
            levelConfig(id){ 
                // Êõ¥Âπ≥ÊªëÁöÑÈöæÂ∫¶Êõ≤Á∫øÔºåÈÄÇÂ∫î100ÂÖ≥
                const target = 400 + (id-1) * 120 + Math.floor((id-1)/10) * 200; // ÊØè10ÂÖ≥Â¢ûÂä†È¢ùÂ§ñÈöæÂ∫¶
                const moves = Math.max(15, this.baseMoves - Math.floor((id-1)/5)); // Êõ¥ÁºìÊÖ¢ÁöÑÊ≠•Êï∞ÂáèÂ∞ë
                return {target, moves}; 
            }
            setThemeColor(id){ const color=this.accentColors[(id-1)%this.accentColors.length]; document.body.style.background=`linear-gradient(135deg, ${color} 0%, #222 100%)`; }
            startLevel(id){ if(!this.initCanvas()){ showError('ÁîªÂ∏ÉÂàùÂßãÂåñÂ§±Ë¥•'); return;} if(id!==0 && !this.unlockedLevels[id]){ alert('ËØ•ÂÖ≥Âç°Êú™Ëß£ÈîÅ'); return;} this.levelId=id===0?'Ëá™Áî±':id; const cfg=id===0?{target:0,moves:9999}:this.levelConfig(id); if(id!==0){ this.gemTypes=Math.min(3+Math.floor((id-1)/8),this.allColors.length); this.gemColors=this.allColors.slice(0,this.gemTypes);} this.targetScore=cfg.target; this.moves=cfg.moves; this.score=0; this.selectedGem=null; this.isPlaying=true; this.comboChain=0; this.currentChain=0; this.effects=[]; this.currentTool=null; this.colorToolAvailable=true; // ÈáçÁΩÆ‰∏ÄÊ¨°ÊÄßÂΩ©ËôπÂ∑•ÂÖ∑
                const colorBtn=document.getElementById('toolColorBomb'); if(colorBtn){ colorBtn.disabled=false; colorBtn.classList.remove('active'); colorBtn.style.opacity='1'; }
                this.generateInitialGrid(); this.placeObstacles(); this.updateObjectiveUI(); this.updateUI(); this.setThemeColor(id===0?1:id); this.play('bg',0.3); this.ensureAudioUnlock();
            }
            updateObjectiveUI(){ const l=document.getElementById('currentLevel'); const o=document.getElementById('objective'); if(l) l.textContent=this.levelId; if(o) o.textContent=this.levelId==='Ëá™Áî±'?'Ëá™Áî±Ê®°ÂºèÔºöÊó†ÈôêÂàÜÊï∞':`ÁõÆÊ†áÂàÜÊï∞: ${this.targetScore}`; }
            // ÂàùÂßãÂåñÊ£ãÁõòÈÅøÂÖçÂàùÂßãÂåπÈÖç
            generateInitialGrid(){ this.grid=[]; for(let y=0;y<this.gridSize;y++){ this.grid[y]=[]; for(let x=0;x<this.gridSize;x++){ let type; do{ type=Math.floor(Math.random()*this.gemTypes);} while(this.causesImmediateMatch(x,y,type)); this.grid[y][x]={type,x,y,special:null}; } } }
            causesImmediateMatch(x,y,type){ if(x>=2 && this.grid[y][x-1] && this.grid[y][x-2] && this.grid[y][x-1].type===type && this.grid[y][x-2].type===type) return true; if(y>=2 && this.grid[y-1] && this.grid[y-2] && this.grid[y-1][x] && this.grid[y-2][x] && this.grid[y-1][x].type===type && this.grid[y-2][x].type===type) return true; return false; }
            // ÈöúÁ¢çÊîæÁΩÆÔºöstone(ÈòªÊå°) ‰∏é ÂÜ∞(ÈîÅÂÆöÂÆùÁü≥)
            placeObstacles(){ 
                if(this.levelId==='Ëá™Áî±') return; 
                // Êõ¥Âπ≥ÊªëÁöÑÈöúÁ¢çÂ¢ûÈïøÊõ≤Á∫øÔºåÈÄÇÂ∫î100ÂÖ≥
                const stoneProb = Math.min(0.02 + (this.levelId-1) * 0.002, 0.15); 
                const iceProb = Math.min(0.03 + (this.levelId-1) * 0.003, 0.25); 
                for(let y=0;y<this.gridSize;y++) 
                    for(let x=0;x<this.gridSize;x++){ 
                        if(Math.random()<stoneProb){ 
                            this.grid[y][x]={obstacle:'stone',hp:2,x,y}; 
                        } else if(Math.random()<iceProb){ 
                            const g=this.grid[y][x]; 
                            if(g) g.locked=1; 
                        } 
                    } 
            }
            // ËæìÂÖ•
            handleClick(e){ if(!this.isPlaying || this.animating) return; const r=this.canvas.getBoundingClientRect(); const x=Math.floor((e.clientX-r.left)/this.tileSize); const y=Math.floor((e.clientY-r.top)/this.tileSize); if(x<0||x>=this.gridSize||y<0||y>=this.gridSize) return; if(this.currentTool){ this.useTool(x,y); return;} const cell=this.grid[y][x]; if(cell && cell.locked){ this.showTip('üîí Ë¢´ÂÜ∞Â∞Å',(x+0.5)*this.tileSize,(y+0.5)*this.tileSize); return;} if(!this.selectedGem){ this.selectedGem={x,y}; } else { if(this.selectedGem.x===x && this.selectedGem.y===y){ this.selectedGem=null; } else if(this.isAdjacent(this.selectedGem,{x,y})){ this.attemptSwap(this.selectedGem,{x,y}); this.selectedGem=null; } else { this.selectedGem={x,y}; } } }
    // ÈÅìÂÖ∑
    useTool(x,y){ const tool=this.currentTool; const cell=this.grid[y][x]; if(tool==='color'){ if(!this.colorToolAvailable){ this.showTip('üö´ Â∑≤‰ΩøÁî®',(x+0.5)*this.tileSize,(y+0.5)*this.tileSize); this.afterToolAffect(); return;} if(cell && !cell.obstacle){ cell.special='color'; this.showTip('üåà',(x+0.5)*this.tileSize,(y+0.5)*this.tileSize); this.colorToolAvailable=false; const btn=document.getElementById('toolColorBomb'); if(btn){ btn.disabled=true; btn.classList.remove('active'); btn.style.opacity='.45'; } } }
        else if(tool==='shuffle'){ if(this.shuffleBoard()) this.showTip('üîÅ Â∑≤Ê¥óÁâå',250,240); }
        this.afterToolAffect(); }
    afterToolAffect(){ this.currentTool=null; this.highlightTools(); this.updateUI(); }
    activateTool(name){ if(this.animating) return; this.currentTool=this.currentTool===name?null:name; this.highlightTools(); }
    highlightTools(){ const map={toolShuffle:'shuffle',toolColorBomb:'color'}; Object.keys(map).forEach(id=>{ const el=document.getElementById(id); if(el){ if(this.currentTool===map[id]) el.classList.add('active'); else el.classList.remove('active'); } }); }
    // Âü∫Á°ÄÈÄªËæë
    isAdjacent(a,b){ return (Math.abs(a.x-b.x)+Math.abs(a.y-b.y))===1; }
    attemptSwap(a,b){ const g1=this.grid[a.y][a.x]; const g2=this.grid[b.y][b.x]; if((g1&&g1.locked)||(g2&&g2.locked)) { this.showTip('üîí Êó†Ê≥ïÁßªÂä®',(b.x+0.5)*this.tileSize,(b.y+0.5)*this.tileSize); return; } this.swapRaw(a,b); const s1=this.grid[a.y][a.x]; const s2=this.grid[b.y][b.x]; const specialInvolved=s1.special||s2.special; let groups=this.findMatches(); if(groups.length===0 && specialInvolved){ this.moves--; this.triggerSpecialSwap(s1,s2); this.updateUI(); return;} if(groups.length===0){ this.swapRaw(a,b); this.play('combo',0.2);} else { this.moves--; this.processMatches(groups,1);} this.updateUI(); }
    swapRaw(a,b){ const g1=this.grid[a.y][a.x]; const g2=this.grid[b.y][b.x]; this.grid[a.y][a.x]=g2; if(g2){g2.x=a.x; g2.y=a.y;} this.grid[b.y][b.x]=g1; if(g1){g1.x=b.x; g1.y=b.y;} }
    triggerSpecialSwap(g1,g2){ const isLine=g=>g&&(g.special==='lineH'||g.special==='lineV'); if(g1.special==='color'&&g2.special==='color'){ const cells=[]; for(let y=0;y<this.gridSize;y++)for(let x=0;x<this.gridSize;x++) cells.push({x,y}); this.clearCells(cells,'ÂèåÂΩ©ËôπÂÖ®Ê∏Ö',80); this.showTip('üåàüåà ÂÖ®ÊùøÊ∏ÖÈô§!',250,250); this.cascade(1); return; } if((g1.special==='color'&&isLine(g2))||(g2.special==='color'&&isLine(g1))){ const lineGem=g1.special==='color'?g2:g1; const targetType=lineGem.type; const cellsSet=new Set(); for(let y=0;y<this.gridSize;y++) for(let x=0;x<this.gridSize;x++){ const cell=this.grid[y][x]; if(cell && cell.type===targetType){ if(lineGem.special==='lineH'){ for(let cx=0;cx<this.gridSize;cx++) cellsSet.add(y+','+cx);} else { for(let cy=0;cy<this.gridSize;cy++) cellsSet.add(cy+','+x);} } } const cells=[]; cellsSet.forEach(k=>{ const [y,x]=k.split(',').map(Number); cells.push({x,y}); }); this.clearCells(cells,'ÂΩ©ËôπÁ∫øÊÄßÈó™Áîµ',90); this.showTip('üåà‚ö° ÂΩ©ËôπÁ∫øÊÄßÈó™Áîµ!',250,250); this.cascade(1); return;} if(g1.special==='color'||g2.special==='color'){ const target=g1.special==='color'?g2:g1; const cells=[]; for(let y=0;y<this.gridSize;y++) for(let x=0;x<this.gridSize;x++) if(this.grid[y][x].type===target.type) cells.push({x,y}); cells.push({x:target.x,y:target.y}); this.clearCells(cells,'ÂΩ©ËôπÊ∏ÖËâ≤',70); this.showTip('üåà Ê∏ÖÈô§È¢úËâ≤!',250,250); this.cascade(1); return; } if(isLine(g1)&&isLine(g2)){ const rows=new Set([g1.y,g2.y]); const cols=new Set([g1.x,g2.x]); [...rows].forEach(r=>{ if(r-1>=0) rows.add(r-1); if(r+1<this.gridSize) rows.add(r+1); }); [...cols].forEach(c=>{ if(c-1>=0) cols.add(c-1); if(c+1<this.gridSize) cols.add(c+1); }); const cells=[]; rows.forEach(r=>{ this.addLineEffect('h',r); for(let x=0;x<this.gridSize;x++) cells.push({x,y:r});}); cols.forEach(c=>{ this.addLineEffect('v',c); for(let y=0;y<this.gridSize;y++) cells.push({x:c,y});}); this.clearCells(cells,'ÂèåÁ∫øÊÄßÂº∫Âåñ',65); this.showTip('‚ö°‚ö° ÂèåÁ∫øÊÄßÂº∫Âåñ!',250,250); this.cascade(1); return;} const toClear=[]; if(isLine(g1)) this.collectLine(g1,toClear); if(isLine(g2)) this.collectLine(g2,toClear); this.clearCells(toClear,'Á∫øÊÄßÊ∂àÈô§',60); this.showTip('‚ö° Á∫øÊÄßÊ∂àÈô§',250,250); this.cascade(1); }
    collectLine(g,arr){ if(!g) return; if(g.special==='lineH'){ this.addLineEffect('h',g.y); for(let x=0;x<this.gridSize;x++) arr.push({x,y:g.y}); } else if(g.special==='lineV'){ this.addLineEffect('v',g.x); for(let y=0;y<this.gridSize;y++) arr.push({x:g.x,y}); } }
    addLineEffect(orientation,index){ this.effects.push({orientation,index,progress:0}); }
    clearCells(cells,reason,base=50){ const uniq=new Set(); cells.forEach(c=>uniq.add(c.x+','+c.y)); let count=0; uniq.forEach(key=>{ const [xS,yS]=key.split(','); const x=+xS,y=+yS; const cell=this.grid[y]&&this.grid[y][x]; if(!cell) return; if(cell.obstacle==='stone'){ cell.hp--; if(cell.hp<=0){ this.spawnParticles(x,y,{type:0}); this.grid[y][x]=null; count++; } return; } if(cell.locked){ cell.locked--; this.spawnParticles(x,y,cell); count++; return; } this.spawnParticles(x,y,cell); this.grid[y][x]=null; count++; }); const gained=count*base; this.score+=gained; this.play('pop',0.55); this.updateUI(); }
    findMatches(){ const groups=[]; // Ê∞¥Âπ≥
        for(let y=0;y<this.gridSize;y++){ let run=[]; for(let x=0;x<this.gridSize;x++){ const c=this.grid[y][x]; if(!c||c.obstacle==='stone'){ if(run.length>=3) groups.push({cells:run.slice(),orientation:'h'}); run=[]; continue;} if(run.length===0||c.type===run[run.length-1].type) run.push(c); else { if(run.length>=3) groups.push({cells:run.slice(),orientation:'h'}); run=[c]; } } if(run.length>=3) groups.push({cells:run.slice(),orientation:'h'}); }
        for(let x=0;x<this.gridSize;x++){ let run=[]; for(let y=0;y<this.gridSize;y++){ const c=this.grid[y][x]; if(!c||c.obstacle==='stone'){ if(run.length>=3) groups.push({cells:run.slice(),orientation:'v'}); run=[]; continue;} if(run.length===0||c.type===run[run.length-1].type) run.push(c); else { if(run.length>=3) groups.push({cells:run.slice(),orientation:'v'}); run=[c]; } } if(run.length>=3) groups.push({cells:run.slice(),orientation:'v'}); }
        return groups; }
    processMatches(groups,chain){ if(groups.length===0) return; this.animating=true; const toRemove=new Set(); const specials=[]; let baseScore=0; groups.forEach(g=>{ const len=g.cells.length; g.cells.forEach(c=>toRemove.add(c.y+','+c.x)); if(len===3) baseScore+=60; else if(len===4){ baseScore+=120; const p=g.cells[1]; specials.push({x:p.x,y:p.y,type:p.type,special:g.orientation==='h'?'lineH':'lineV'}); } else if(len>=5){ baseScore+=200+(len-5)*40; const p=g.cells[2]; specials.push({x:p.x,y:p.y,type:p.type,special:'color'}); } }); const perGemBonus=toRemove.size*10; baseScore+=perGemBonus; const multiplier=1+(chain-1)*0.5; const gained=Math.floor(baseScore*multiplier); this.score+=gained; this.currentChain=chain; this.play(chain>1?'combo':'pop', chain>1?0.9:0.6); toRemove.forEach(k=>{ const [y,x]=k.split(',').map(Number); this.spawnParticles(x,y,this.grid[y][x]); this.grid[y][x]=null; }); specials.forEach(sp=>{ this.grid[sp.y][sp.x]={type:sp.type,x:sp.x,y:sp.y,special:sp.special}; }); this.showTip(`+${gained}${chain>1?` (ËøûÈîÅx${multiplier.toFixed(1)})`:''}`,250,260-(chain-1)*28); this.updateUI(); this.cascade(chain); }
    cascade(chain){ for(let x=0;x<this.gridSize;x++){ for(let y=this.gridSize-1;y>=0;y--){ if(this.grid[y][x]==null){ for(let k=y-1;k>=0;k--){ if(this.grid[k][x]!=null){ this.grid[y][x]=this.grid[k][x]; this.grid[y][x].y=y; this.grid[k][x]=null; break; } } } } } for(let y=0;y<this.gridSize;y++) for(let x=0;x<this.gridSize;x++) if(this.grid[y][x]==null) this.grid[y][x]={type:Math.floor(Math.random()*this.gemTypes),x,y,special:null}; const newGroups=this.findMatches(); if(newGroups.length>0){ setTimeout(()=>this.processMatches(newGroups,chain+1),220);} else { this.animating=false; setTimeout(()=>{ this.currentChain=0; this.updateUI(); },600); this.ensureMoves(); this.postMoveCheck(); } }
    hasPossibleMoves(){ const trySwap=(ax,ay,bx,by)=>{ const A=this.grid[ay][ax]; const B=this.grid[by][bx]; if(!A||!B||A.obstacle==='stone'||B.obstacle==='stone') return false; this.grid[ay][ax]=B; this.grid[by][bx]=A; const ok=this.findMatches().length>0; this.grid[ay][ax]=A; this.grid[by][bx]=B; return ok; }; for(let y=0;y<this.gridSize;y++) for(let x=0;x<this.gridSize;x++){ if(x+1<this.gridSize && trySwap(x,y,x+1,y)) return true; if(y+1<this.gridSize && trySwap(x,y,x,y+1)) return true; } return false; }
    shuffleBoard(){ const flat=[]; for(let y=0;y<this.gridSize;y++) for(let x=0;x<this.gridSize;x++) if(this.grid[y][x]) flat.push(this.grid[y][x]); let attempts=0; while(attempts<60){ for(let i=flat.length-1;i>0;i--){ const j=(Math.random()*(i+1))|0; [flat[i],flat[j]]=[flat[j],flat[i]]; } let idx=0; for(let y=0;y<this.gridSize;y++) for(let x=0;x<this.gridSize;x++){ const g=flat[idx++]; g.x=x; g.y=y; this.grid[y][x]=g; } if(this.findMatches().length===0 && this.hasPossibleMoves()) return true; attempts++; } return false; }
    ensureMoves(){ if(!this.hasPossibleMoves()){ const ok=this.shuffleBoard(); if(ok) this.showTip('üîÅ Êó†ÂèØË°åÂä®‰ΩúÔºåËá™Âä®Ê¥óÁâå',250,240); else this.showTip('‚ö†Ô∏è Ê¥óÁâåÂ§±Ë¥•',250,240);} }
    postMoveCheck(){ if(this.levelId!=='Ëá™Áî±' && this.score>=this.targetScore){ this.levelWin(); } else if(this.moves<=0 && this.levelId!=='Ëá™Áî±'){ this.levelFail(); } }
    levelWin(){ 
        this.play('win',0.9); 
        
        // ‰øùÂ≠òÂÆåÊàêËÆ∞ÂΩï
        this.saveCompletedLevel(this.levelId);
        
        alert(`ÂÖ≥Âç° ${this.levelId} ÂÆåÊàê! ÂàÜÊï∞: ${this.score}`); 
        if(!this.unlockedLevels[this.levelId+1]){ 
            this.unlockedLevels[this.levelId+1]=true; 
            this.saveUnlocked(); 
        } 
        this.isPlaying=false; 
        SimpleUI.showScreen('levelSelect'); 
    }
    levelFail(){ this.play('lose',0.9); alert(`ÂÖ≥Âç°Â§±Ë¥•ÔºÅÂàÜÊï∞: ${this.score}`); this.isPlaying=false; SimpleUI.showScreen('levelSelect'); }
    // ËßÜËßâ
    spawnParticles(x,y,gem){ if(!gem) return; const px=x*this.tileSize+this.tileSize/2; const py=y*this.tileSize+this.tileSize/2; for(let i=0;i<10;i++){ this.particles.push({x:px,y:py,vx:(Math.random()-0.5)*5,vy:(Math.random()-0.5)*5,life:35,color:this.gemColors[gem.type%this.gemColors.length]}); } }
    updateParticles(){ this.particles=this.particles.filter(p=>p.life>0); this.particles.forEach(p=>{ p.x+=p.vx; p.y+=p.vy; p.vy+=0.07; p.life--; }); this.effects=this.effects.filter(e=>e.progress<1); this.effects.forEach(e=>{ e.progress+=0.04; }); }
    updateUI(){ const s=document.getElementById('score'); const m=document.getElementById('moves'); if(s) s.textContent=this.score; if(m) m.textContent=(this.levelId==='Ëá™Áî±')?'‚àû':this.moves; const c=document.getElementById('chainInfo'); if(c) c.textContent=this.currentChain>1?`${this.currentChain}Ëøû (x${(1+(this.currentChain-1)*0.5).toFixed(1)})`:'-'; }
    showTip(text,x,y){ const layer=document.getElementById('tipLayer'); if(!layer) return; const d=document.createElement('div'); d.className='floating-tip'; d.textContent=text; d.style.left=x+'px'; d.style.top=y+'px'; layer.appendChild(d); setTimeout(()=>{ if(d.parentNode) d.parentNode.removeChild(d); },1300); }
            drawGem(x,y,type){ 
                const gem=this.grid[y][x]; 
                if(!gem) return; 
                
                const img=this.images[type%this.images.length]; 
                const cx=x*this.tileSize; 
                const cy=y*this.tileSize; 
                
                // Ê£ÄÊü•ÂõæÁâáÊòØÂê¶ÂèØÁî® - Êõ¥‰∏•Ê†ºÁöÑÊ£ÄÊü•
                const canDrawImg = img && img.complete && !img.failed && img.naturalWidth>0 && img.loaded && img.src; 
                
                if(canDrawImg){ 
                    try {
                        this.ctx.drawImage(img, cx+4, cy+4, this.tileSize-8, this.tileSize-8);
                        // ÁªòÂà∂ÁâπÊÆäÊ†áËÆ∞
                        this.drawSpecialMarkers(gem, cx, cy);
                    } catch(e) {
                        console.error(`ÁªòÂà∂ÂõæÁâáÂ§±Ë¥• (type=${type}):`, e);
                        this.drawFallbackGem(cx, cy, type, gem);
                    }
                } else { 
                    // ÂõûÈÄÄÂà∞È¢úËâ≤ÂúÜÂΩ¢
                    this.drawFallbackGem(cx, cy, type, gem);
                    
                    // Âè™Âú®Á¨¨‰∏ÄÊ¨°ÊòæÁ§∫ÊèêÁ§∫ÔºåÈÅøÂÖçÂà∑Â±è
                    if(!this.imageWarned){ 
                        this.showTip('üñºÔ∏è ‰ΩøÁî®È¢úËâ≤Êõø‰ª£ÂÆùÁü≥ÂõæÁâá', 250, 200); 
                        this.imageWarned=true; 
                        console.log(`‰ΩøÁî®È¢úËâ≤Êõø‰ª£ÂÆùÁü≥ÂõæÁâá (Ê£ÄÊµãÂà∞ ${this.imagesLoadedCount} Âº†ÂõæÁâáÂä†ËΩΩÊàêÂäü)`);
                    }
                }
            }        // ÊèêÂèñÁªòÂà∂Â§áÁî®ÂÆùÁü≥ÁöÑÊñπÊ≥ï
        drawFallbackGem(cx, cy, type, gem) {
            const r=this.tileSize/2-6; 
            const mx=cx+this.tileSize/2; 
            const my=cy+this.tileSize/2; 
            this.ctx.fillStyle=this.gemColors[type%this.gemColors.length]; 
            this.ctx.beginPath(); 
            this.ctx.arc(mx, my, r, 0, Math.PI*2); 
            this.ctx.fill();
            
            // ÁªòÂà∂‰∏Ä‰∏™ÁôΩËâ≤ËæπÊ°ÜÔºåËÆ©ÂÆùÁü≥Êõ¥ÊòìÂå∫ÂàÜ
            this.ctx.strokeStyle = '#fff';
            this.ctx.lineWidth = 2;
            this.ctx.stroke();
            
            // ÊòæÁ§∫ÂÆùÁü≥Á±ªÂûãÁºñÂè∑Â∏ÆÂä©Ë∞ÉËØï
            this.ctx.fillStyle = '#fff';
            this.ctx.font = '14px Arial';
            this.ctx.textAlign = 'center';
            this.ctx.textBaseline = 'middle';
            this.ctx.fillText(type.toString(), mx, my);
            
            // ÁªòÂà∂ÁâπÊÆäÊ†áËÆ∞
            if(gem) {
                this.drawSpecialMarkers(gem, cx, cy);
            }
            
            // È´òÂÖâ
            this.ctx.fillStyle='rgba(255,255,255,0.35)'; 
            this.ctx.beginPath(); 
            this.ctx.arc(cx+this.tileSize/2 - this.tileSize/6, cy+this.tileSize/2 - this.tileSize/6, this.tileSize/6,0,Math.PI*2); 
            this.ctx.fill();
        }
        
        // ÂàÜÁ¶ªÁâπÊÆäÊ†áËÆ∞ÁªòÂà∂ÈÄªËæë
        drawSpecialMarkers(gem, cx, cy) {
            if(!gem.special) return;
            
            this.ctx.save(); 
            this.ctx.strokeStyle='#fff'; 
            this.ctx.lineWidth=4;
            
            if(gem.special==='lineH'){ 
                this.ctx.beginPath(); 
                this.ctx.moveTo(cx+8,cy+this.tileSize/2); 
                this.ctx.lineTo(cx+this.tileSize-8,cy+this.tileSize/2); 
                this.ctx.stroke(); 
            }
            else if(gem.special==='lineV'){ 
                this.ctx.beginPath(); 
                this.ctx.moveTo(cx+this.tileSize/2,cy+8); 
                this.ctx.lineTo(cx+this.tileSize/2,cy+this.tileSize-8); 
                this.ctx.stroke(); 
            }
            else if(gem.special==='color'){ 
                this.ctx.fillStyle='rgba(255,255,255,0.75)'; 
                this.ctx.beginPath(); 
                this.ctx.arc(cx+this.tileSize/2,cy+this.tileSize/2,this.tileSize/5,0,Math.PI*2); 
                this.ctx.fill(); 
            }
            
            this.ctx.restore();
        }
    drawObstacle(x,y,cell){ const cx=x*this.tileSize; const cy=y*this.tileSize; this.ctx.fillStyle='#555'; this.ctx.fillRect(cx+4,cy+4,this.tileSize-8,this.tileSize-8); this.ctx.strokeStyle='#999'; this.ctx.strokeRect(cx+4,cy+4,this.tileSize-8,this.tileSize-8); this.ctx.fillStyle='#fff'; this.ctx.font='bold 16px sans-serif'; this.ctx.fillText(cell.hp,cx+this.tileSize/2-5,cy+this.tileSize/2+6); }
    drawIce(x,y){ const cx=x*this.tileSize; const cy=y*this.tileSize; this.ctx.strokeStyle='rgba(173,216,230,0.8)'; this.ctx.lineWidth=3; this.ctx.strokeRect(cx+3,cy+3,this.tileSize-6,this.tileSize-6); }
    render(){ if(!this.ctx) return; this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height); this.ctx.strokeStyle='#2225'; this.ctx.lineWidth=1; for(let x=0;x<=this.gridSize;x++){ this.ctx.beginPath(); this.ctx.moveTo(x*this.tileSize,0); this.ctx.lineTo(x*this.tileSize,this.gridSize*this.tileSize); this.ctx.stroke(); } for(let y=0;y<=this.gridSize;y++){ this.ctx.beginPath(); this.ctx.moveTo(0,y*this.tileSize); this.ctx.lineTo(this.gridSize*this.tileSize,y*this.tileSize); this.ctx.stroke(); } for(let y=0;y<this.gridSize;y++) for(let x=0;x<this.gridSize;x++){ const cell=this.grid[y][x]; if(!cell) continue; if(cell.obstacle==='stone') this.drawObstacle(x,y,cell); else { this.drawGem(x,y,cell.type); if(cell.locked) this.drawIce(x,y); } } if(this.selectedGem){ this.ctx.strokeStyle='#ff0000'; this.ctx.lineWidth=3; this.ctx.strokeRect(this.selectedGem.x*this.tileSize+2,this.selectedGem.y*this.tileSize+2,this.tileSize-4,this.tileSize-4); } this.updateParticles(); this.particles.forEach(p=>{ this.ctx.globalAlpha=Math.max(0,p.life/35); this.ctx.fillStyle=p.color; this.ctx.fillRect(p.x-2,p.y-2,4,4); this.ctx.globalAlpha=1; }); this.effects.forEach(e=>{ const alpha=1-e.progress; this.ctx.save(); this.ctx.globalAlpha=alpha; const pulse=(Math.sin(e.progress*10)+1)/2; if(e.orientation==='h'){ const y=e.index*this.tileSize; this.ctx.fillStyle=`rgba(255,255,0,${0.35+0.35*pulse})`; this.ctx.fillRect(0,y,this.gridSize*this.tileSize,this.tileSize); } else { const x=e.index*this.tileSize; this.ctx.fillStyle=`rgba(255,255,0,${0.35+0.35*pulse})`; this.ctx.fillRect(x,0,this.tileSize,this.gridSize*this.tileSize); } this.ctx.restore(); }); requestAnimationFrame(()=>this.render()); }
    // ÊéßÂà∂
    restartGame(){
        const lvl=this.levelId==='Ëá™Áî±'?0:this.levelId;
        if(confirm('ÈáçÊñ∞ÂºÄÂßãÂΩìÂâçÂÖ≥Âç°?')){
            this.startLevel(lvl);
        }
    }
}
// ÈáçÊñ∞ÂÆö‰πâ initGame ‰Ωç‰∫éÁ±ªÂ§ñ
function initGame(){
    debugLog('ÂàùÂßãÂåñÊ∏∏ÊàèÂºïÊìé...');
    try {
        GameEngine=new SimpleGameEngine();
        const q=id=>document.getElementById(id);
        q('startGameBtn').onclick=()=>{ GameEngine.ensureAudioUnlock(); SimpleUI.startLevel(1); };
        q('levelSelectBtn').onclick=()=>SimpleUI.showScreen('levelSelect');
        q('freePlayBtn').onclick=()=>{ GameEngine.ensureAudioUnlock(); SimpleUI.startLevel(0); };
        q('backToMenuBtn').onclick=()=>SimpleUI.showScreen('mainMenu');
        q('restartBtn').onclick=()=>GameEngine.restartGame();
        q('backToLevelSelectBtn').onclick=()=>SimpleUI.showScreen('levelSelect');
        q('muteBtn').onclick=()=>GameEngine.toggleMute();
        q('toolShuffle').onclick=()=>GameEngine.activateTool('shuffle');
        q('toolColorBomb').onclick=()=>GameEngine.activateTool('color');
        const audioFileInput=q('audioFileInput');
        q('loadAudioBtn').onclick=()=>{ GameEngine.loadAudioPack('9439'); audioFileInput.click(); };
        audioFileInput.onchange=e=>{ const files=[...e.target.files]; if(!files.length) return; const map={'bg':'bgMusic','pop':'popSound','combo':'comboSound','win':'winSound','lose':'loseSound'}; files.forEach(f=>{ const name=f.name.toLowerCase(); for(const k in map){ if(name.includes(k)){ const el=q(map[k]); el.src=URL.createObjectURL(f); el.load(); break;} } }); GameEngine.showTip('üéµ Ëá™ÂÆö‰πâÈü≥ÊïàÂ∑≤Âä†ËΩΩ',250,220); GameEngine.ensureAudioUnlock(); };
        debugLog('Ê∏∏ÊàèÂàùÂßãÂåñÂÆåÊàê'); setTimeout(()=>{const d=q('debugInfo'); if(d) d.style.display='none';},1200);
    }catch(e){ console.error(e); showError('ÂàùÂßãÂåñÂ§±Ë¥•: '+e.message);} }

        // ÂÖ®Â±ÄÈîôËØØÁõëÂê¨
        window.addEventListener('error', e=>{
            console.error(e.error||e.message);
            debugLog('ËÑöÊú¨ÈîôËØØ: '+e.message,'error');
        });
        window.addEventListener('unhandledrejection', e=>{
            console.error(e.reason);
            debugLog('Êú™Â§ÑÁêÜPromise: '+e.reason,'error');
        });
        
        // ÂàõÂª∫ÁõÆÂΩïÊ£ÄÊü•ÂáΩÊï∞
        function checkResourcePaths() {
            console.log("=== ÂºÄÂßãÊ£ÄÊü•ËµÑÊ∫êË∑ØÂæÑ ===");
            debugLog("Ê£ÄÊü•ËµÑÊ∫êÁõÆÂΩïÂíåÊñá‰ª∂ÂèØËÆøÈóÆÊÄß...");
            
            // Ê£ÄÊü•ÂõæÁâáË∑ØÂæÑ
            for(let i = 0; i < 3; i++) {
                const testImage = new Image();
                const imgPath = `images/gem${i}.png`;
                
                testImage.onload = () => {
                    console.log(`‚úì ÂõæÁâáË∑ØÂæÑÊ≠£Â∏∏: ${imgPath} ÂèØ‰ª•ËÆøÈóÆ`);
                    if(i === 0) debugLog("ÂõæÁâáËµÑÊ∫êÁõÆÂΩïÂèØËÆøÈóÆ");
                };
                
                testImage.onerror = () => {
                    console.error(`‚úó ÂõæÁâáË∑ØÂæÑÈîôËØØ: ${imgPath} Êó†Ê≥ïËÆøÈóÆ`);
                    if(i === 0) debugLog("Ë≠¶Âëä: images ÁõÆÂΩïÂèØËÉΩ‰∏çÂ≠òÂú®ÊàñÊó†ÊùÉÈôêËÆøÈóÆ");
                };
                
                testImage.src = imgPath;
            }
            
            // Ê£ÄÊü•Èü≥È¢ëË∑ØÂæÑ
            const testAudio = new Audio();
            testAudio.oncanplaythrough = () => {
                console.log("‚úì Èü≥È¢ëË∑ØÂæÑÊ≠£Â∏∏: audio/9439/bg.mp3 ÂèØ‰ª•ËÆøÈóÆ");
                debugLog("Èü≥È¢ëËµÑÊ∫êÁõÆÂΩïÂèØËÆøÈóÆ");
            };
            testAudio.onerror = () => {
                console.error("‚úó Èü≥È¢ëË∑ØÂæÑÈîôËØØ: audio/9439/bg.mp3 Êó†Ê≥ïËÆøÈóÆ");
                debugLog("Ë≠¶Âëä: audio/9439 ÁõÆÂΩïÂèØËÉΩ‰∏çÂ≠òÂú®ÊàñÊó†ÊùÉÈôêËÆøÈóÆ");
            };
            testAudio.src = "audio/9439/bg.mp3";
            
            // ÂàõÂª∫ÁõÆÂΩïÁªìÊûÑÊèêÁ§∫
            setTimeout(() => {
                console.log("=== ËµÑÊ∫êÁõÆÂΩïÁªìÊûÑË¶ÅÊ±Ç ===");
                console.log("ËØ∑Á°Æ‰øù‰ª•‰∏ãÁõÆÂΩïÁªìÊûÑÂ≠òÂú®:");
                console.log("Ê∂àÊ∂à‰πê/");
                console.log("‚îú‚îÄ‚îÄ game-ultimate.html");
                console.log("‚îú‚îÄ‚îÄ images/");
                console.log("‚îÇ   ‚îú‚îÄ‚îÄ gem0.png  (Á∫¢Ëâ≤ÂÆùÁü≥)");
                console.log("‚îÇ   ‚îú‚îÄ‚îÄ gem1.png  (ËìùËâ≤ÂÆùÁü≥)");
                console.log("‚îÇ   ‚îú‚îÄ‚îÄ gem2.png  (ÁªøËâ≤ÂÆùÁü≥)");
                console.log("‚îÇ   ‚îú‚îÄ‚îÄ gem3.png  (ÈªÑËâ≤ÂÆùÁü≥)");
                console.log("‚îÇ   ‚îú‚îÄ‚îÄ gem4.png  (Á¥´Ëâ≤ÂÆùÁü≥)");
                console.log("‚îÇ   ‚îú‚îÄ‚îÄ gem5.png  (Ê©ôËâ≤ÂÆùÁü≥)");
                console.log("‚îÇ   ‚îú‚îÄ‚îÄ gem6.png  (ÈùíËâ≤ÂÆùÁü≥)");
                console.log("‚îÇ   ‚îú‚îÄ‚îÄ gem7.png  (ÊµÖÁªøÂÆùÁü≥)");
                console.log("‚îÇ   ‚îî‚îÄ‚îÄ gem8.png  (Á≤âËâ≤ÂÆùÁü≥)");
                console.log("‚îî‚îÄ‚îÄ audio/");
                console.log("    ‚îî‚îÄ‚îÄ 9439/");
                console.log("        ‚îú‚îÄ‚îÄ bg.mp3    (ËÉåÊôØÈü≥‰πê)");
                console.log("        ‚îú‚îÄ‚îÄ pop.mp3   (Ê∂àÈô§Èü≥Êïà)");
                console.log("        ‚îú‚îÄ‚îÄ combo.mp3 (ËøûÂáªÈü≥Êïà)");
                console.log("        ‚îú‚îÄ‚îÄ win.mp3   (ËÉúÂà©Èü≥Êïà)");
                console.log("        ‚îî‚îÄ‚îÄ lose.mp3  (Â§±Ë¥•Èü≥Êïà)");
                console.log("=== Ê≥®ÊÑè‰∫ãÈ°π ===");
                console.log("1. Á°Æ‰øùÊñá‰ª∂Ë∑ØÂæÑÂíåÊñá‰ª∂ÂêçÂÆåÂÖ®ÂåπÈÖçÔºàÂå∫ÂàÜÂ§ßÂ∞èÂÜôÔºâ");
                console.log("2. ÂõæÁâáÊñá‰ª∂ÂøÖÈ°ªÊòØPNGÊ†ºÂºè");
                console.log("3. Èü≥È¢ëÊñá‰ª∂ÂøÖÈ°ªÊòØMP3Ê†ºÂºè");
                console.log("4. Â¶ÇÊûúÁº∫Â∞ëÊñá‰ª∂ÔºåÊ∏∏Êàè‰ºöËá™Âä®‰ΩøÁî®Â§áÁî®ÊñπÊ°à");
            }, 1500);
        }
        
        // DOM ÂáÜÂ§áÂêéÂêØÂä®
        if(document.readyState==='loading'){
            document.addEventListener('DOMContentLoaded', () => {
                checkResourcePaths();
                initGame();
            });
        } else {
            checkResourcePaths();
            initGame();
        }
    </script>
</body>
</html>
